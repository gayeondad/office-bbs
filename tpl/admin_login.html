{% extends "layout.html" %} 

{% block title %}관리자::로그인{% endblock %} 

{% block head %} {{ parent() }}
<script src="/rsc/js/helper.js" defer></script>
{% endblock %} 

{%block nav %}{% endblock %} 

{% block content %}
<div class="border rounded p-0 mx-auto my-5 w-50">
  <!-- <img class="mb-4" src="/docs/5.3/assets/brand/bootstrap-logo.svg" alt="" width="72" height="57"> -->
  <div class="border-bottom rounded-top mb-3 bg-body-secondary">
    <h3 class="px-5 py-3">Please sign in</h3>
  </div>

  <p id="errmsg" style="color: red"></p>

  <form id="loginform" class="p-5">
    <input type="hidden" name="a" value="i" />
    <div class="alert-container" id="messageArea"></div>
    <div class="row mb-3">
      <label for="userid" class="col-sm-3 col-form-label">아이디</label>
      <div class="col-sm-9">
        <input
          type="text"
          class="form-control"
          name="id"
          value="{{ cookie }}"
          id="userid"
          required
          autocomplete="off"
        />
      </div>
    </div>
    <div class="row mb-3">
      <label for="userpw" class="col-sm-3 col-form-label">패스워드</label>
      <div class="col-sm-9">
        <input
          type="password"
          class="form-control"
          name="pw"
          id="userpw"
          required
        />
      </div>
    </div>
    <div class="form-check text-start my-3">
      <input
        class="form-check-input"
        type="checkbox"
        name="savedId"
        value="ok"
        id="savedId"
        {% if cookie is not empty %} checked="checked"{% endif %}
      />
      <label class="form-check-label" for="savedId"> Remember me </label>
    </div>
    <button class="btn btn-primary w-100 py-2" type="submit">Sign in</button>
    <p class="mt-5 mb-3 text-body-secondary">© 2021–2025</p>
  </form>
</div>
{% endblock %} 

{% block footer %}{% endblock %} 

{% block after_script %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const loginform = document.getElementById("loginform");

    loginform.addEventListener("submit", async (event) => {
      event.preventDefault();

      const fData = new FormData(loginform);
      console.log(fData.entries());
      for (const [key, value] of fData.entries()) {
        console.log(`${key}: ${value}`);
      }

      // const params = new URLSearchParams(fData);
      // console.log(params);
      // return;

      try {
        const data = await sendRequest('proc.php', {
          method: 'POST',
          // headers: {
          //   'Content-Type': 'application/json; charset=utf-8',		// 필수
          // },
          // body: JSON.stringify(postData),				// 필수
          body: fData,
        });
        let obj = JSON.parse(data);
        if (!obj) {
          throw new Error("응답 데이터가 JSON 형식이 아닙니다.");
        }
        // console.log("Login Response: ", data);
        // console.log("Login Response Type: ", typeof data);
        // console.log("Login Response Success: ", data.success);
        if (obj.success) {
          // displayMessage(messageArea, data.message, 'success');
          // setTimeout(() => {
            document.location.reload();
          // }, 1000);
        } else {
          displayMessage(messageArea, `저장 실패: ${obj.message}`, 'danger');
        }
      } catch (error) {
        console.error("Save Fetch Error: ", error);
        displayMessage(messageArea, `네트워크 또는 서버 에러: ${error.message}`, 'danger');
      }
    });
  });
</script>
{% endblock %}
